
# 工程备注

## 架构
层与层之间的调用接口定义在lib/include/srsran/interfaces  

### radio层
* radio层与SDR平台对接
lib/include/phy/rf/,rf.h定义射频前端的接口,rf_dev.h定义支持的sdr设备,  
每种sdr设备,需要对rf.h接口进行实现,放在lib/src/phy/rf,源码名为rf_xxx_imp.  
* radio层与phy层对接
radio层向phy层提供的接口,主要定义在lib/include/srsran/interfaces/radio_interfaces.h,  
lib/src/srsran/radio/radio.cc对这些接口进行实现,具体来说,就是对上面提到的rf.h接口进行包装.  
* 备注
radio层的sdr对接代码放到了phy层的文件夹里,很奇怪.  

### phy层
1. phy层函数调用分析
(1) 公用代码: lib/include/srsran/phy
modem:调制解调,  
fec:前向纠错,  
phch:将modem,fec,rf等流程串起来,封装成specifications中规定的physical channel,  
gnb:在phch的基础上封装gnb节点,enb和ue同理.此即phy层公用代码暴露的调用接口.  
备注:channel文件夹似乎是channel emulator,仅供模拟.  
(2) enb: srsenb/phy
slot_worker,worker_pool,txrx,三部分源码指定了phy层的运行线程.  
slot_worker中即调用了phy层公用代码gnb_dl/gnb_ul所封装的接口.  
txrx对slot_worker和worker_pool进一步封装.注意txrx中的run_thread()主循环,即和规范中的subframe对应上了.  
注意radio部分的调用也在这里进行.rx_now在txrx主线程中出现,tx在slot_worker-work_imp最后的worker_end中出现.  
slot_worker,worker_pool,txrx,会同其它一些代码,统一封装到phy.h.  
2. phy层数据流动
以radio_h->rx_now和radio_h->tx为起点,在txrx中的run_thread()主循环和slot_worker中的work_ul(),work_dl()追踪一下,即可大概了解其流动情况.  


//* misc
//lib/include/srsran/interfaces/phy_common_interface.h定义很粗略,具体会在继承srsenb/srsue/...中继承并拓展,  

## 流程
///每一层分配一个线程池,独立运行.线程相关定义在lib/include/common/threadxxx
